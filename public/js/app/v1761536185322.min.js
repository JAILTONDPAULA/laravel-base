class Request{static call(t,e,a,o=null,i=!0,n={},s="json"){$.ajax({url:t,type:e,type:e,dataType:s,data:a,headers:n,beforeSend(){i&&Preload.show()},error(t,e,a){401!==t.status||["/login","/senha"].includes(location.pathname)?(Preload.hide(),Dialog.close("all","Erro na Requisição",t.responseText)):location.href="/login"},success(t,e,a){o&&o(t,a.status)}})}}let typingTimer,typingDelay=300;$(document).ready(function(){$(document).on("click",".linha>div>svg",Tabela.ordem.selecionar),$(document).on("input paste",".searchbox",function(){clearTimeout(typingTimer),typingTimer=setTimeout(()=>{Tabela.buscador.filtrar.call(this)},typingDelay)}),$(document).on("input paste",".coringa",Tabela.buscador.selecionaTodos),$(document).on("change",".listbox input:not(.coringa)",Tabela.buscador.filtrarCk),$(document).on("click",function(t){var t=$(t.target),e=t.closest(".cl_filtro");e.length?($(".cl_filtro").not(e).find(".boxfilter").css({height:"0px",padding:"0px","box-shadow":"none"}),t.is(".boxfilter *")||t.closest(".boxfilter").length||Tabela.buscador.mostrar.call(e[0])):$(".cl_filtro .boxfilter").css({height:"0px",padding:"0px","box-shadow":"none"})}),$(document).on("click","#download_xls",Tabela.download),$(document).on("click",".paginacao button.number",function(){Paginacao.selecionar(this)}),$(document).on("click",".paginacao .next",Paginacao.next),$(document).on("click",".paginacao .back",Paginacao.prev),$(document).on("click","#tabela01 .last",function(){Paginacao.last()}),$(document).on("click","#tabela01 .first",Paginacao.buttons),$(document).on("change","#quantitypage",Tabela.alterpage.change)}),Tabela=class{static download(){var t,e;window.xls&&Array.isArray(window.xls)&&0!==window.xls.length?(t=JSON.parse($(".tabela").data("linhas")).map(e=>{let a={};return window.xls.forEach(t=>{a[t.novoNome]=e[t.original]}),a}),t=XLSX.utils.json_to_sheet(t),e=XLSX.utils.book_new(),XLSX.utils.book_append_sheet(e,t,"Relatorio"),XLSX.writeFile(e,"relatorio.xlsx")):alert("XLS não configurado")}static func=t=>{alert("Função estática 'func' ainda não foi definida!")};static indicador=t=>null;static buscador={mostrar(){$(this).find(".boxfilter").css({height:"fit-content",padding:"2px","box-shadow":"1px 1px 1px 1px #0002"}).find("[type=tel]").focus()},ocultar(){let t=this;setTimeout(()=>{t.contains(document.activeElement)||$(t).find(".boxfilter").css({height:"0px",padding:"0px","box-shadow":"none"})},25)},filtrar(){var i=new RegExp(this.value,"i"),t=$(this).siblings(".listbox").find("label");$.each(t,(t,e)=>{var a="coringa"===$(e).find("input").data("prop"),o=$(e).find("input").val();a||i.test(o)?$(e).slideDown(200,function(){$(this).css({display:"flex"})}):$(e).slideUp(200)})},selecionaTodos(){$(this).closest(".listbox").find("input").prop("checked",this.checked),this.checked&&$(this).closest(".listbox").find("input:not(.coringa)").eq(0).trigger("change");let e=$(this).closest(".boxfilter").attr("id");window.filterorder=window.filterorder||[],window.filterorder=window.filterorder.filter(t=>t!==e)},filtrarCk(){var t=$(this).closest(".listbox").find("input:not(.coringa):checked").map((t,e)=>e.value).get(),t=($(this).closest(".boxfilter").data("valores",t),$(this).closest(".listbox").find("input:not(.coringa)").length),e=$(this).closest(".listbox").find("input:not(.coringa):checked").length,a=$(this).closest(".boxfilter").attr("id");window.filterorder=window.filterorder||[],window.filterorder.includes(a)||window.filterorder.push(a),e<t?$(this).closest(".cl_filtro").find("div>svg,>span").css({background:"var(--p-orange-500)"}):($(this).closest(".cl_filtro").find("div>svg").css({background:"#0000"}),$(this).closest(".cl_filtro").find(">span").css({background:"#0000"})),Tabela.buscador.filtrarline()},filtrarline(t=null){let s=JSON.parse($(".tabela").data("original")),r=(Tabela.buscador.ordernador(),s);window.ordemfinal.map((t,e)=>{let a=$("#"+t).data("prop"),o=$("#"+t).data("valores"),i=(r=Array.isArray(o)?0<o.length?r.filter(e=>o.some(t=>t==(e[a]||"null"))):[]:r)?r.map(t=>t[a]):[];var n=[...new Set(s.map(t=>t[a]))].sort().map(e=>`<label><input type="checkbox" value="${e}" ${i.some(t=>t==e)?"checked":""}>${e}</label>`).join("");parseInt($("#"+t).css("height"))<=2&&$(`#${t} .listbox`).html(`<label><input type="checkbox" value="&" class="coringa" ${s.length===r.length?"checked":""}></label>`+n),s=r}),r=window.criterio?Tabela.ordem.ordenarPorCriterios(r,window.criterio):r,$(".tabela").data("linhas",JSON.stringify(r)),Tabela.indicador(),t||($(".tabela .linha:not(.cabecalho)").remove(),Paginacao.buttons()),t?$(".idline"+t).fadeOut(200).fadeIn(200).fadeOut(200).fadeIn(200):Paginacao.buttons(),Tabela.buscador.contador(r)},contador(r){window.contadores.forEach(t=>{let[e,a,o,i]=t,n=0;switch(e){case"Q":var s=new Set(r.map(t=>t[a]));n=s.size;break;case"P":n=void 0===i?(console.warn(`Tipo P requer um valor para filtrar. Contador: [${t.join(", ")}]`),0):r.filter(t=>t[a]===i).length;break;case"S":n=r.reduce((t,e)=>t+(parseFloat(e[a])||0),0);break;case"R":n=(n=r.reduce((t,e)=>t+(parseFloat(e[a])||0),0)).toLocaleString("pt-BR",{style:"currency",currency:"BRL"});break;default:return void console.warn(`Tipo ${e} não reconhecido.`)}$(o).text(n)})},ordernador(){window.ordemfinal=[],window.filterorder=window.filterorder||[];var t,e,a=new Set;for(t of window.filterorder)window.filterorigin.includes(t)&&!a.has(t)&&(window.ordemfinal.push(t),a.add(t));for(e of window.filterorigin)a.has(e)||window.ordemfinal.push(e)}};static ordem={selecionar(t){t.stopPropagation(),window.criterio=window.criterio||[];let e=this.dataset.chave;var t=window.criterio.findIndex(t=>t.chave===e),a=JSON.parse($(".tabela").data("linhas")),t=($(this).is(".asc")?($(this).replaceWith(`<svg xmlns="http://www.w3.org/2000/svg" data-chave="${e}" class="desc" height="16px" viewBox="0 -960 960 960" width="16px" fill="var(--p-orange-500)"><path d="M412-114v-470L210-383l-96-97 366-366 366 366-96 98-202-202v470H412Z"/></svg>`),-1===t?window.criterio.push({chave:e,ordem:"desc"}):window.criterio[t].ordem="desc"):$(this).is(".desc")?($(this).replaceWith(`<svg xmlns="http://www.w3.org/2000/svg" data-chave="${e}" height="16px" viewBox="0 -960 960 960" width="16px" fill="#fff"><path d="M86-172v-125h291v125H86Zm0-245v-125h539v125H86Zm0-245v-125h788v125H86Z"/></svg>`),-1!==t&&window.criterio.splice(t,1)):($(this).replaceWith(`<svg xmlns="http://www.w3.org/2000/svg" data-chave="${e}" class="asc" height="16px" viewBox="0 -960 960 960" width="16px" fill="var(--p-orange-500)"><path d="M412-114v-470L210-383l-96-97 366-366 366 366-96 98-202-202v470H412Z"/></svg>`),-1===t?window.criterio.push({chave:e,ordem:"asc"}):window.criterio[t].ordem="asc"),Tabela.ordem.ordenarPorCriterios(a,window.criterio));$(".tabela").data("linhas",JSON.stringify(t)),$(".tabela .linha:not(.cabecalho)").remove(),Paginacao.buttons()},ordenarPorCriterios(t,e){return t.sort((a,o)=>{for(var i of e){var{chave:i,ordem:n}=i;let t=a[i],e=o[i];i=t=>null==t;if(!i(t)||!i(e)){if(i(t))return"asc"===n?1:-1;if(i(e))return"asc"===n?-1:1;var i=t=>"string"==typeof t&&/^\d{4}-\d{2}-\d{2}( \d{2}:\d{2}:\d{2})?$/.test(t),s=t=>"number"==typeof t&&!isNaN(t)||"string"==typeof t&&/^-?\d+(\.\d+)?$/.test(t)&&!isNaN(parseFloat(t));if(i(t)&&i(e)?(t=new Date(t),e=new Date(e)):s(t)&&s(e)?(t=parseFloat(t),e=parseFloat(e)):("string"==typeof t&&(t=t.toLowerCase()),"string"==typeof e&&(e=e.toLowerCase())),t<e)return"asc"===n?-1:1;if(t>e)return"asc"===n?1:-1}}return 0})}};static alterpage={change(){Paginacao.itens="all"===$(this).val()?JSON.parse($(".tabela").data("original")).length:parseInt($(this).val()),Tabela.buscador.filtrarline()}}},Paginacao=class{static itens=50;static buttons(){var t=JSON.parse($(".tabela").data("linhas")),e=($("#tabela01").find("button.number").remove(),""),a=10<t.length/Paginacao.itens?10:t.length/Paginacao.itens;for(let t=0;t<a;t++)e+=`<button type="button" class="number">${t+1}</button>`;$("#tabela01").find("button.back").after(e),$("#tabela01 button.number").eq(0).addClass("selected"),Paginacao.selecionar($("button.number").eq(0)[0])}static selecionar(t){var e=JSON.parse($(".tabela").data("linhas")),a=($(t).closest(".paginacao").find("button.number").removeClass("selected"),$(t).addClass("selected"),parseInt($(t).text())<e.length/Paginacao.itens&&$(t).next().is(".next")?($(t).after(`<button type="button" class="number">${parseInt($(t).text())+1}</button>`),$(t).closest(".paginacao").find(".back").next().remove()):$(t).prev().is(".back")&&"1"!=$(t).text()&&($(t).closest(".paginacao").find(".back").after(`<button type="button" class="number">${parseInt($(t).text())-1}</button>`),$(t).closest(".paginacao").find(".next").prev().remove()),(parseInt($(t).text())-1)*Paginacao.itens),o=e.slice(a,a+Paginacao.itens);$(t).closest(".paginacao").find(".first,.back").prop("disabled","1"==$(t).text()),$(t).closest(".paginacao").find("span").text(`${1+a} até ${a+o.length} de `+e.length),$(".tabela").find(".linha:not(.cabecalho)").remove(),$(".tabela").append(o.map(Tabela.func).join(""))}static last(){$("#tabela01").find("button.number").remove();var t=JSON.parse($(".tabela").data("linhas")),e="",a=Math.ceil(t.length/Paginacao.itens)<=10?Math.ceil(t.length/Paginacao.itens):10,o=Math.ceil(t.length/Paginacao.itens);for(let t=0;t<a;t++)e=`<button type="button" class="number">${o}</button>`+e,o--;$("#tabela01").find("button.back").after(e),$("#tabela01 button.number").eq(-1).addClass("selected").trigger("click")}static next(){$(this).closest(".paginacao").find(".selected").next().trigger("click")}static prev(){$(this).closest(".paginacao").find(".selected").prev().trigger("click")}};class Preload{static show(){$("body").css("overflow","hidden"),$(".preload").css("display","flex")}static hide(){$(".preload").css("display","none"),$("body").css("overflow","auto")}}class Dialog{static open(t,e,a,o){$(".dialog-form").attr("id",t),$(".dialog-form .titulo").text(e),$(".dialog-form .body").html(a),$('.dialog-form .footer button[type="submit"]').remove(),o&&$(".dialog-form .footer").append(`<button type="submit">${o}</button>`),$(".containerdialog").css({transform:"translateX(0)",opacity:1})}static close(){$(".containerdialog").css({transform:"translateX(-100%)",opacity:0})}}$(document).ready(function(){$(document).on("click",".close-modal",Dialog.close)});class Toast{static containerSelector=".toast-container";static types={success:"toast-success",error:"toast-error",alert:"toast-alert",neutral:"toast-neutral"};static show(t,e="neutral",a=!1){if(!document.querySelector(Toast.containerSelector)){let t=document.createElement("div");t.className="toast-container",document.body.appendChild(t)}let o=document.querySelector(Toast.containerSelector),i=document.createElement("div");i.className="toast "+(Toast.types[e]||Toast.types.neutral);e=document.createElement("span"),e.textContent=t,i.appendChild(e),t=document.createElement("button");t.className="toast-close",t.innerHTML="&times;",t.onclick=()=>i.remove(),i.appendChild(t),o.appendChild(i),a||setTimeout(()=>{i.remove()},3500)}static success(t,e=!1){Toast.show(t,"success",e)}static error(t,e=!1){Toast.show(t,"error",e)}static alert(t,e=!1){Toast.show(t,"alert",e)}static neutral(t,e=!1){Toast.show(t,"neutral",e)}}